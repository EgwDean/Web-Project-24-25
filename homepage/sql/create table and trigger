CREATE TABLE anakoinosi (
  info TEXT,
  date_exam DATETIME
) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

DELIMITER //

CREATE TRIGGER fix_anakoinosi
AFTER INSERT ON eksetasi_diplomatikis
FOR EACH ROW
BEGIN
 
 DECLARE student_name VARCHAR(255);
 DECLARE student_surname VARCHAR(255);
 DECLARE dip_title VARCHAR(255);
 
 SELECT name, surname
 INTO student_name, student_surname
 FROM student
 INNER JOIN anathesi_diplomatikis
 ON anathesi_diplomatikis.email_stud = student.email_student
 WHERE anathesi_diplomatikis.id_diploma = NEW.id_diplomatikis;
 
 SELECT title
 INTO dip_title
 FROM diplomatiki 
 WHERE id_diplomatiki = NEW.id_diplomatikis;
 
INSERT INTO anakoinosi(info, date_exam)
VALUES (
    CONCAT(
        'Ο/Η φοιτητής με όνομα ', 
        student_name, ' ', 
        student_surname, 
        ', θα εξεταστεί στην διπλωματική με τίτλο: ', 
        dip_title, 
        ', στις ', 
        DATE_FORMAT(NEW.exam_date, '%Y-%m-%d %H:%i:%s'), 
        ', στην αίθουσα/link: ', 
        NEW.exam_room
    ),
    NEW.exam_date
);
  
  
END //

DELIMITER ;

